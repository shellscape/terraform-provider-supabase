# supabase_edge_function (Resource)

Manages a Supabase Edge Function. Edge Functions are server-side TypeScript functions that run on the Deno runtime, allowing you to execute custom logic close to your users.

Refer to the [Supabase Edge Functions documentation](https://supabase.com/docs/guides/functions) for more information.

## Example Usage

### Basic Edge Function

```terraform
resource "supabase_edge_function" "hello_world" {
  project_ref = "abcdefghijklmnopqrst"
  slug        = "hello-world"
  name        = "Hello World Function"
  body        = file("${path.module}/functions/hello-world.ts")
  verify_jwt  = false
}
```

### Protected Edge Function with JWT Verification

```terraform
resource "supabase_edge_function" "protected_api" {
  project_ref        = "abcdefghijklmnopqrst"
  slug               = "protected-api"
  name               = "Protected API Function"
  body               = file("${path.module}/functions/protected-api.ts")
  verify_jwt         = true
  compute_multiplier = 2.0
  entrypoint_path    = "index.ts"
  import_map         = true
  import_map_path    = "import_map.json"
}
```

### Example Function Code

**hello-world.ts:**
```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"

serve(async (req) => {
  const { name } = await req.json()
  const data = {
    message: `Hello ${name}!`,
  }

  return new Response(
    JSON.stringify(data),
    { headers: { "Content-Type": "application/json" } },
  )
})
```

**protected-api.ts:**
```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

serve(async (req) => {
  try {
    const supabaseClient = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_ANON_KEY') ?? '',
      { global: { headers: { Authorization: req.headers.get('Authorization')! } } }
    )

    const { data: { user } } = await supabaseClient.auth.getUser()

    if (!user) {
      return new Response(
        JSON.stringify({ error: 'Unauthorized' }),
        { status: 401, headers: { 'Content-Type': 'application/json' } }
      )
    }

    return new Response(
      JSON.stringify({ 
        message: `Hello ${user.email}! This is a protected function.`,
        user_id: user.id 
      }),
      { headers: { 'Content-Type': 'application/json' } }
    )
  } catch (error) {
    return new Response(
      JSON.stringify({ error: error.message }),
      { status: 400, headers: { 'Content-Type': 'application/json' } }
    )
  }
})
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `body` (String) Function source code
- `name` (String) Function display name
- `project_ref` (String) Project reference ID
- `slug` (String) Function slug (URL path component)

### Optional

- `compute_multiplier` (Number) Compute multiplier for the function (affects performance and billing)
- `entrypoint_path` (String) Path to the function entrypoint file
- `import_map` (Boolean) Whether to use import map
- `import_map_path` (String) Path to the import map file
- `verify_jwt` (Boolean) Whether to verify JWT tokens for this function

### Read-Only

- `created_at` (Number) Unix timestamp when the function was created
- `id` (String) Function ID
- `status` (String) Function status
- `updated_at` (Number) Unix timestamp when the function was last updated

## Import

Edge functions can be imported using the project reference and function slug:

```shell
terraform import supabase_edge_function.example <project_ref>/<function_slug>
```

For example:

```shell
terraform import supabase_edge_function.hello_world abcdefghijklmnopqrst/hello-world
```

## Notes

- The `slug` field is used as the URL path component and cannot be changed after creation (marked as `RequiresReplace`)
- The `project_ref` also cannot be changed after creation (marked as `RequiresReplace`) 
- Function code is stored in the `body` attribute and should typically use `file()` to read from external TypeScript files
- When `verify_jwt` is enabled, the function will automatically validate JWT tokens from the `Authorization` header
- The `compute_multiplier` affects both performance and billing - higher values provide more CPU/memory but cost more
- Edge Functions run on the Deno runtime and support modern JavaScript/TypeScript features
- Functions are deployed to Supabase's global edge network for low latency worldwide